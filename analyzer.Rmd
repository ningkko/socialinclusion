---
title: "Social Inclusion Analysis"
author: "Yining Hua"
date: "9/16/2021"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(lme4)
library(texreg)
library(stargazer)
library(readr)
library(dplyr)
library(ggplot2)
```

```{r}
dat <- read_csv("~/urbanplanning/preliminary_data.csv")

dat$migration.type <- NA
dat$migration.type[dat$migration.self == 1] <- "self"
dat$migration.type[dat$migration.fellows == 1] <- "fellows"
dat$migration.type[dat$migration.relatives == 1] <- "relatives"

col_names <- c("ethnicity","marriage","diabete_hypertension","group","recent_disease","insuranced","gender","worked_before5.1")
dat[,col_names] <- lapply(dat[,col_names] , factor)

dat$money.left <- dat$income - dat$expence
dat$participant <- as.character(dat$participant)

dat$health <- as.numeric(dat$health)*1000
```
```{r}
head(dat)
```

```{r}
dat$natives_inclusion <- dat$natives.like.me-dat$natives.lookdown.me
dat$city_inclusion <- dat$like.current.city-dat$native.customs.better+dat$i.am.native
dat$tendency.livehere <- dat$willing.to.movein + dat$willing.to.stay
dat$migration.companionship <- - dat$migration.self + dat$migration.relatives + dat$migration.fellows
# dat$loneliness.level <- (dat$loneliness.level-min(dat$loneliness.level, na.rm=TRUE))/(max(dat$loneliness.level, na.rm = TRUE)-min(dat$loneliness.level, na.rm = TRUE)) ## normalization

dat
```
```{r}
## regroup education
dat$education.group <- NA
dat$education.group[dat$education == 0] <- "0"
dat$education.group[(dat$education == 1) || (dat$education == 2) ] <- "1, 2"
dat$education.group[dat$education == 3] <- "3"
dat$education.group[(dat$education == 4) || (dat$education == 5)] <- "4, 5"
dat$education.group[dat$education == 6] <- "6"
```

```{r}
## regroup ethnicity 
dat$ethnicity.group <- "other"
dat$ethnicity.group[dat$ethnicity == 1] <- "han"
```

```{r}
cbPalette <- c("#e61212", "#ffb300", "#22ff00", "#0015ff", "#00fbff")

p1 <- ggplot(dat, aes(health, colour = group, fill=group)) +
      geom_bar(alpha=0.8) +
      labs(
           x = "Level of health",
           colour = "group") +
      theme_classic(base_size = 10)
p1
```


```{r}
m0 <- lmer(health ~ group + like.current.city + natives.like.me + natives.lookdown.me + native.customs.better + i.am.native + willing.to.movein + willing.to.stay + (1|participated_in_group_activity) + (1|migration.companionship) + (1|money.left) + (1|job) + (1|migration_scale) + (1| education) + (1 |gender) + (1|ethnicity.group) + (1|marriage) + (1|recent_disease) + (1|insuranced), 
           data=dat)
```


```{r}

m1 <- lmer(health ~ group + natives_inclusion + city_inclusion + tendency.livehere + (1|participated_in_group_activity)
           + (1|migration.type) + (1|money.left) + (1|job) + (1|migration_scale)+  (1| education) + (1 |gender) + (1|ethnicity.group) + (1|marriage) + (1|recent_disease) + (1|insuranced), 
           data=dat)
```



```{r}
screenreg(c(m0,m1))
```

```{r}
write_csv(dat,"processed_data.csv")
```

